<!DOCTYPE html>
<!-- https://developer.byu.edu/docs/consume-api/use-api/oauth-20/oauth-20-javascript-sample-code -->
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>OAuth Flows Simple Test Client</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/themes/prism.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/CodeFlask.js/0.1.1/codeflask.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js" async></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/CodeFlask.js/0.1.1/codeflask.min.js" async></script>
	<script src="/js/jquery-3.5.1.js" axync></script>
	<script src="/js/FileSaver.js"></script>
	<script src="/js/index.js"></script>
	<link rel="stylesheet" href="/css/site.css">
	<style>
		label { width:200px; display: inline-block; }
		input { width:600px; display: inline-block; }
		input#pkce { width:auto; display: inline-block; }
		input#ropc { width:auto; display: inline-block; }
	</style>
  </head>
  <body>
	<div class="container">
	<p id="un-authenticated-msg" style="display:none;">
	  <h1>OIDC Simple Auth Client</h1>	
	  <a href="https://github.com/cljung/oidc_simple_client" target="_blank">github repo</a>
	  <p>
	  	Configuration is stored in Browser Local Storage. You can load it via url, via a local file or via pasting in the correct json in the texbox.
		<br/>
		If you fill in the config from scratch, the *-marked items are mandatory. Config is only stored in browser local storage.
	  </p>
	  <p>
		<button type="button" onclick="loadConfigFromSource()">Load From Url</button>
		<label for="configFile" class="fileUpload">Upload Config File</label>
		<input type="file" id="configFile"/>
		<button type="button" onclick="clearConfig()">Clear</button>
		<button type="button" onclick="downloadConfig()">Download</button>
		<br/><br/>
	  	<label for="configUrl">Config Url/Json: </label>
  		<input type="text" id="configUrl" value=""><br/><br/>
		
	  	<label for="client_id">client_id*: </label>
  		<input type="text" id="client_id" value=""><br/>

	  	<label for="client_secret">client_secret: </label>
  		<input type="password" id="client_secret" value=""><br/>

	  	<label for="redirectUrl">redirectUrl*: </label>
  		<input type="text" id="redirectUrl" value=""><br/>

	  	<label for="scope">scope*: </label>
  		<input type="text" id="scope" value=""><br/>

	  	<label for="resource">resource: </label>
  		<input type="text" id="resource" value=""><br/>

	  	<label for="response_type">response_type*: </label>
  		<input type="text" id="response_type" value="" list="response_type_list">
		<datalist id="response_type_list">
			<option value="code">code</option>
			<option value="code id_token">code id_token</option>
			<option value="code id_token token">code id_token token</option>
			<option value="id_token">id_token</option>
			<option value="id_token token">id_token token</option>
		</datalist>
		<br/>

		<label for="response_mode">response_mode: </label>
  		<input type="text" id="response_mode" value="" list="response_mode_list">
		<datalist id="response_mode_list">
			<option value=""></option>
			<option value="query">query</option>
			<option value="fragment">fragment</option>
			<option value="form_post">form_post</option>
		</datalist>
		<br/>

	  	<label for="promptLogin">prompt:</label>		  
  		<input type="text" id="promptLogin" value="" list="promptLogin_list">
		<datalist id="promptLogin_list">
			<option value=""></option>
			<option value="none">none</option>
			<option value="login">login</option>
			<option value="consent">consent</option>
			<option value="select_account">select_account</option>
			<option value="login+consent">login+consent</option>
			<option value="select_account+consent">select_account+consent</option>
		</datalist>
  		<br/><br/>

		<label for="pkce">PKCE: </label>		  
  		<input type="checkbox" id="pkce" onclick="onPkce()"><br/>

	  	<label for="ropc">ROPC: </label>		  
  		<input type="checkbox" id="ropc" onclick="onRopc()"><br/>
  		<br/><br/>

	  	<label for="metadataUrl">metadataUrl*: </label>
  		<input type="text" id="metadataUrl" value=""><br/>
		  
	  	<label for="authorization_endpoint">authorization_endpoint: </label>
  		<input type="text" id="authorization_endpoint" value=""><br/>

	  	<label for="token_endpoint">token_endpoint: </label>
  		<input type="text" id="token_endpoint" value=""><br/>

	  	<label for="end_session_endpoint">end_session_endpoint: </label>
  		<input type="text" id="end_session_endpoint" value=""><br/><br/>

		<button type="button" onclick="loadMetadata(document.getElementById('metadataUrl').value)">Load Metadata</button>
		<button type="button" onclick="runFlow()">Run Flow</button>

	  </p>
	  <p>
		Microsoft Entra documentation: 
		<a href="https://learn.microsoft.com/en-us/entra/identity-platform/v2-oauth2-auth-code-flow" target="_blank">auth code flow</a>
		&nbsp;
		<a href="https://learn.microsoft.com/en-us/entra/identity-platform/v2-oauth2-implicit-grant-flow" target="_blank">implicit grant flow</a>
		&nbsp;
		<a href="https://learn.microsoft.com/en-us/entra/identity-platform/v2-oauth-ropc" target="_blank">ROPC flow</a>
	  </p>
	</p>
  </div>
  </body>
</html>
